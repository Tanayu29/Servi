# 03_architecture.md
# 全体アーキテクチャ設計

本ドキュメントは、本システムにおける全体構成を言語化し、
各コンポーネントの役割と責任範囲を明確にすることを目的とする。

本システムは「人間の代わりに考え、作業を補助・代行する」ことを目的とし、
完全自律ではなく、人間主導・AI補助を基本方針とする。

---

## 1. 全体構成の概要

本システムは以下の4層構造で構成される。

1. インターフェース層
2. オーケストレーション層
3. エージェント層
4. ツール・データ層

各層は責務を明確に分離し、直接的な依存を最小限に抑える。

---

## 2. インターフェース層（Interface Layer）

### 役割
- 人間との接点を担う
- 指示、確認、結果提示を行う

### 想定インターフェース
- CLI
- Web UI（将来）
- チャットUI（将来）

### 特徴
- 業務ロジックを持たない
- すべての処理要求はオーケストレーション層へ渡す
- 人間による承認・却下を明示的に受け付ける

---

## 3. オーケストレーション層（Orchestration Layer）

### 中核コンポーネント
- OrchestratorAgent

### 役割
- 処理全体の流れを制御する
- 各エージェントへの依頼・結果回収を行う
- 人間介入が必要なポイントを判断する

### OrchestratorAgentの責務
- タスクの受付
- 主担当エージェントの選定
- 実行順序の制御
- 例外発生時の制御
- ログの集約

### 補足
- OrchestratorAgent自身は専門判断を行わない
- 判断は必ず専門エージェントに委譲する

---

## 4. エージェント層（Agent Layer）

### 基本方針
- エージェントは「判断を伴う責務」を持つ
- 状態（文脈・履歴）を保持する
- 単純作業は行わない

### エージェント一覧

#### 4-1. KnowledgeAgent
- 知識の生成・整理・検索を担当
- 情報を再利用可能な形に変換する
- ナレッジベース、手順書、トラブル事例を扱う

#### 4-2. AutomationAgent
- 定型作業の実行を担当
- Excel操作、在庫管理、経理処理などを扱う
- 判断は行わず、成功・失敗を結果として返す

#### 4-3. PlanningAgent
- タスク管理・優先度判断を担当
- 締め切り、進捗、負荷を監視する
- ルールベースから開始し、将来的に高度化可能

#### 4-4. BusinessSupportAgent
- 副業支援を担当
- トレンド分析、仕入れ候補、売価提案を行う
- リスクを言語化し、人間の意思決定を補助する

#### 4-5. LearningAgent
- システム全体の振り返りを担当
- 成功・失敗ログから改善案を生成する
- 自動反映は禁止し、提案のみを行う

---

## 5. ツール・データ層（Tool & Data Layer）

### 役割
- 実際の作業・データ処理を行う
- エージェントから直接呼び出される

### 主な構成要素
- Pythonスクリプト
- 外部API
- ファイル操作モジュール
- データベース（将来）

### 特徴
- 状態を持たない
- 再利用可能な関数群として実装
- ログ出力を必須とする

---

## 6. データとログの流れ

### 基本方針
- すべての処理はログとして記録する
- 判断の根拠を後から追跡できるようにする

### ログの種類
- 実行ログ
- 判断ログ
- エラー・例外ログ
- 人間承認ログ

### ログの利用先
- LearningAgentによる分析
- トラブルシューティング
- ナレッジベース生成

---

## 7. 人間介入ポイント

以下の場合は必ず人間の確認を必要とする。

- 外部への影響がある処理
- 金銭を伴う判断
- 自己学習によるルール変更
- 不確実性が高い判断

---

## 8. 設計上の重要方針

- 完全自律を目指さない
- 判断責務を明確に分離する
- 小さく作り、壊しながら育てる
- 設計ドキュメントとコードを常に同期させる

---

## 9. 今後の拡張余地

- エージェントの細分化
- Web UIの追加
- 外部サービス連携
- 自然言語による指示の高度化
