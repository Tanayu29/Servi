# 04_agents.md
# エージェント詳細設計

本ドキュメントは、本システムを構成する各エージェントについて、
責務・判断範囲・保持状態・データベースとの関係を明確に定義する。

エージェントは「判断を伴う責務」を持つ単位とし、
単純作業はツールまたは関数に委譲する。

---

## 1. 共通設計方針

### 1-1. エージェントの定義
- 判断を行う
- 文脈や履歴を状態として保持する
- 自身で直接UIやDBを操作しない（例外を除く）

### 1-2. 実行環境前提
- Windows環境でexeとして実行
- SQLiteは社内共有サーバに配置
- 同時書き込みを極力避ける設計とする

### 1-3. データアクセス原則
- DBへの直接書き込みは限定されたエージェントのみが行う
- 読み取りは全エージェント可能
- 書き込みは OrchestratorAgent を経由する

---

## 2. OrchestratorAgent

### 役割
- システム全体の司令塔
- 各エージェントへの依頼と結果の統合

### 判断範囲
- タスクの種類判定
- 主担当エージェントの選定
- 人間介入の要否判断

### 保持状態
- 現在処理中のタスクID
- 実行中フローの進捗
- エージェント呼び出し履歴

### DBとの関係
- 原則として読み取りのみ
- 書き込みは各担当エージェントに委譲

---

## 3. KnowledgeAgent

### 役割
- 知識の生成・整理・検索
- ナレッジベースおよび手順書の中核

### 対応タスク
- ナレッジベース生成
- トラブル対応ナレッジ化
- 手順書作成

### 判断範囲
- 情報の取捨選択
- 抽象化レベルの調整
- 類似ナレッジ判定
- 再利用価値の有無判断

### 保持状態
- 処理対象ドキュメントのメタ情報
- 一時的な要約・タグ情報
- 類似検索の結果キャッシュ

### DBとの関係
- 読み取り: 既存ナレッジ検索
- 書き込み: 新規ナレッジ登録（承認後のみ）

### 制約
- 自動公開は禁止
- 書き込み前に人間レビューを挟む設計とする

---

## 4. AutomationAgent

### 役割
- 定型作業の実行
- 業務処理の自動化

### 対応タスク
- Excel操作
- 在庫管理
- 経理管理

### 判断範囲
- 判断は行わない
- 成功・失敗の判定のみ

### 保持状態
- 実行中ジョブ情報
- エラー内容

### DBとの関係
- 原則として直接操作しない
- 必要なデータは OrchestratorAgent 経由で受け取る

### 特徴
- 冪等性を重視
- 同じ処理を何度実行しても問題が起きない設計

---

## 5. PlanningAgent

### 役割
- タスク管理・進捗管理
- 優先度の判断

### 対応タスク
- 日常業務タスク管理
- 締め切り管理
- 遅延検知

### 判断範囲
- 優先度決定
- タスク再配置
- 人間へのアラート要否

### 保持状態
- タスクリスト
- 進捗履歴
- 過去の遅延パターン

### DBとの関係
- 読み取り: タスク情報
- 書き込み: 状態更新（低頻度）

---

## 6. BusinessSupportAgent

### 役割
- 副業支援専用エージェント

### 対応タスク
- トレンドサーチ
- 仕入れ候補抽出
- 売価レンジ提案

### 判断範囲
- トレンド性の有無
- 利益可能性
- リスク要因の言語化

### 保持状態
- 市場データの一時キャッシュ
- 過去の判断結果

### DBとの関係
- 個人領域のみ使用
- 社内ナレッジDBとは論理的に分離

### 制約
- 業務ユーザからは利用不可
- 自動購入・発注は禁止

---

## 7. LearningAgent

### 役割
- システム全体の改善提案

### 対応タスク
- 実行ログ分析
- 成功・失敗パターン抽出
- 改善案生成

### 判断範囲
- 傾向分析
- ルール・プロンプト改善案作成

### 保持状態
- ログ分析結果
- 提案履歴

### DBとの関係
- 読み取り専用
- 書き込みは禁止

### 制約
- システムへの自動反映は禁止
- 必ず人間承認を必要とする

---

## 8. エージェント間連携ルール

- エージェント同士は直接通信しない
- すべて OrchestratorAgent を介する
- データ受け渡しはJSON形式を基本とする

---

## 9. 今後の拡張指針

- エージェントの細分化は責務が肥大化した時点で行う
- DB負荷が増えた場合はサーバ型DBへ移行可能な構造を維持する
- エージェントの入れ替えを前提とした疎結合設計を保つ
